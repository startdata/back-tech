## DB Lock이란?

> 데이터의 일관성을 보장하기 위한 방법

## Lock의 종류

- Shared Lock(공유 Lock, Read Lock)

  > 데이터를 읽을 때 사용, 원하는 데이터에 lock을 걸었지만 다른 세션에서 읽을 수 있다.  
  > 공유 Lock을 설정할 수 있지만, 배타적 Lock은 설정할 수 없다.  
  > 내가 보고 있는 데이터는 다른 사용자가 볼수는 있지만, 수정 할수 없다.

- Exclusive Lock(배타적 Lock, Write lock)
  > 데이터를 변경할 때 사용, lock이 해제되기 전까지, 다른 공유Lock, 배타적Lock을 설정 할 수 없다.  
  > 읽기와 쓰기가 불가능

## Blocking

> Lock들의 경합이 발생하여 특정 부분의 작업을 진행하지 못하고 멈춰 선 상태  
> `공유Lock과 배타적Lock`이나 `배타적Lock과 배타적Lock`사이에서 블로킹이 발생할 수 있다.

### 해결방법

- Transaction commit
- rollback

  > 경합이 발생할 때, 먼저 Lock을 설정한 트랜잭션을 기다려야한다.

- SQL이 가장 빠르게 실행되도록 수정
- 트랜잭션을 짧게 정의해서 경합을 줄인다.
- 동일한 데이터를 동시에 변경되지 않도록 설계
- 대용량 작업을 할경우,작업단위를 나누거나, lock_timeout을 설정하여 Lock의 최대시간을 설정한다.
